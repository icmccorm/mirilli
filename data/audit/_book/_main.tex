% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[]{natbib}
\bibliographystyle{plainnat}
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Audit},
  pdfauthor={Ian McCormack},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Audit}
\author{Ian McCormack}
\date{2023-01-24}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{introduction}{%
\chapter{Introduction}\label{introduction}}

\hypertarget{abi-distribution}{%
\chapter{ABI Distribution}\label{abi-distribution}}

The maximum number of ABIs defined in a single file.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{by\_count }\OtherTok{\textless{}{-}}\NormalTok{ late\_abis }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{group\_by}\NormalTok{(crate\_name) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarize}\NormalTok{(}\AttributeTok{n=}\FunctionTok{n}\NormalTok{())}
\FunctionTok{print}\NormalTok{(}\FunctionTok{max}\NormalTok{(by\_count}\SpecialCharTok{$}\NormalTok{n))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4
\end{verbatim}

The number of ABI occurrences in files.

\hypertarget{improper-type-errors}{%
\chapter{Improper Type Errors}\label{improper-type-errors}}

We observed 16,771 type errors in foreign bindings. There were 480 unique errors which occurred for 229 unique crates. Of these crates,

There were 46 crates that globally disabled the \texttt{improper\_ctypes} lint, there were 12 crates that globally disabled the \texttt{improper\_types\_definitions} lint, and there were 10 crates that globally disabled both lints.

There were 51 crates that selectively disabled the \texttt{improper\_ctypes} lint, there were 9 crates that selectively disabled the \texttt{improper\_types\_definitions} lint, and there were 0 crates that selectively disabled both lints.

When combined, there were 97 crates that disabled the \texttt{improper\_ctypes} in some fashion, there were 21 crates that selectively disabled the \texttt{improper\_types\_definitions} lint in some fashion, and there were 10 crates that disabled both lints in some fashion.

This provides us with a sample of 107 crates that hid improper type errors.

\begin{verbatim}
## # A tibble: 4 x 7
##   Category          `# Crates` `# Unique Errors` Total        Mean  St.Dev Max  
##   <chr>             <chr>      <chr>             <chr>        <chr> <chr>  <chr>
## 1 Foreign Functions 144 / 93   14 / 14           16140 / 144~ 112.~ 473.6~ 5375~
## 2 Rust Functions    78 / 15    13 / 9            437 / 195    5.6 ~ 15.8 ~ 136 ~
## 3 Static Items      15 / 6     8 / 4             194 / 171    12.9~ 25.3 ~ 99 /~
## 4 All               229 / 107  35 / 27           16771 / 148~ 73.2~ 385.1~ 5474~
\end{verbatim}

\begin{verbatim}
## # A tibble: 16 x 7
##    Type    Error  Unique `Foreign Funct~` `Foreign Items` `Rust Functions` Total
##    <chr>   <chr>   <int>            <dbl>           <dbl>            <dbl> <dbl>
##  1 Adt     EnumN~      2                4               0                0     4
##  2 Adt     EnumN~      3               29               7               21    57
##  3 Adt     Struc~      3             8286             161                7  8454
##  4 Adt     Struc~      1                2               0                0     2
##  5 Adt     Union~      3              912               2               10   924
##  6 Adt     OnlyP~      1                1               0                0     1
##  7 Array   --          2               21               0                0    21
##  8 Char    --          2               19               0                0    19
##  9 Dynamic Dyn         3                3               0                4     7
## 10 FnPtr   --          3              295               1                0   296
## 11 Int     Num12~      2                1               0               66    67
## 12 Slice   --          2                1               0                1     2
## 13 Str     --          2                0               0                4     4
## 14 Tuple   --          3                7               0               24    31
## 15 Uint    Num12~      3             4856               0               58  4914
## 16 All     --         35            14437             171              195 14803
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# large \textless{}{-} function(x)\{}
\CommentTok{\#   paste0(\textquotesingle{}\textbackslash{}textbf\{\textquotesingle{}, x, \textquotesingle{}\}\textquotesingle{})}
\CommentTok{\# \}}
\CommentTok{\# addtorow \textless{}{-} list()}
\CommentTok{\# addtorow$pos \textless{}{-} list(0, 0)}
\CommentTok{\# addtorow$command \textless{}{-} c("\& \& \& \textbackslash{}\textbackslash{}multicolumn\{4\}\{c\}\{\textbackslash{}\textbackslash{}\# Occurrences\} \textbackslash{}\textbackslash{}\textbackslash{}\textbackslash{}\textbackslash{}n",}
\CommentTok{\# "Category \& \textbackslash{}\textbackslash{}\# Crates \& \textbackslash{}\textbackslash{}\# Unique \& Total \& Mean \& St.Dev. \& Max \textbackslash{}\textbackslash{}\textbackslash{}\textbackslash{}\textbackslash{}n")}
\CommentTok{\# xt\_counts = xtable(}
\CommentTok{\#   count\_summary, }
\CommentTok{\#   type = "latex", }
\CommentTok{\#   digits=c(0,0,0,0,0,1,1,0),}
 
\CommentTok{\# )}

\CommentTok{\# align(xt\_counts) \textless{}{-} "llcc|cccc"}
\CommentTok{\# print(xt\_counts, }
\CommentTok{\#       include.rownames = FALSE,}
\CommentTok{\#       add.to.row = addtorow, }
\CommentTok{\#       file = "../latex/err\_counts.tex",}
\CommentTok{\#       include.colnames = FALSE,}
\CommentTok{\#       sanitize.colnames.function = large,}
\CommentTok{\#       floating=FALSE,}
\CommentTok{\#       latex.environments=NULL}
\CommentTok{\# )}

\CommentTok{\# addtorow \textless{}{-} list()}
\CommentTok{\# addtorow$pos \textless{}{-} list(0, 0)}
\CommentTok{\# addtorow$command \textless{}{-} c("\& \& \& \textbackslash{}\textbackslash{}multicolumn\{4\}\{c\}\{\textbackslash{}\textbackslash{}\# Hidden Occurrences\} \textbackslash{}\textbackslash{}\textbackslash{}\textbackslash{}\textbackslash{}n",}
\CommentTok{\# "Error Category \& Error \& \textbackslash{}\textbackslash{}\# Unique \& Foreign Functions \& Foreign Items \& Rust Functions \& Total \textbackslash{}\textbackslash{}\textbackslash{}\textbackslash{}\textbackslash{}n")}
\CommentTok{\# xt\_type\_counts \textless{}{-} xtable(}
\CommentTok{\#   filtered, }
\CommentTok{\#   type = "latex", }
\CommentTok{\#   digits=c(0,0,0,0,0,0,0,0),}
\CommentTok{\#   floating=FALSE,}
\CommentTok{\#   latex.environments=NULL}
\CommentTok{\# )}
\CommentTok{\# align(xt\_type\_counts) \textless{}{-} "lllc|cccc"}
\CommentTok{\# print(xt\_type\_counts, }
\CommentTok{\#       include.rownames = FALSE,}
\CommentTok{\#       add.to.row = addtorow, }
\CommentTok{\#       file = "../latex/err\_type\_counts.tex",}
\CommentTok{\#       include.colnames = FALSE,}
\CommentTok{\#       sanitize.colnames.function = large,}
\CommentTok{\#       floating=FALSE,}
\CommentTok{\#       latex.environments=NULL}
\CommentTok{\#     )}
\end{Highlighting}
\end{Shaded}

\hypertarget{quantitative-results}{%
\chapter{Quantitative Results}\label{quantitative-results}}

We began with a snapshot of the \href{https://crates.io/data-access}{crates.io} database taken on 12/20/2022, which contained 102,359 crates. After filtering out crates without any valid published versions, 98,501 crates remained. We ran our linting tool on this population. Prior to linting, we found that the latest version of 57 crates contained an empty archive when downloaded from crates.io. For crates with non-empty archives, 85,694 passed the early linting stage, while 12,807 failed it. Of those that passed the early linting stage, 83,533 passed the late linting stage, while 2,161 failed it. We use the subset of crates that passed both linting stages as the basis for our study, which comprises \textbf{82\% of all crates} in the database. Though 474 crates that passed the late linting stage failed to compile, we still include these in our sample to avoid excluding crates that have valid Rust code but are missing dependencies that cargo cannot provide.

\hypertarget{abi-distribution-1}{%
\section{ABI Distribution}\label{abi-distribution-1}}

\begin{verbatim}
## # A tibble: 7 x 2
##   abi                `sum(count)`
##   <chr>                     <dbl>
## 1 C                         84310
## 2 C-unwind                      1
## 3 platform-intrinsic           46
## 4 Rust                      95021
## 5 stdcall                     128
## 6 system                      415
## 7 win64                         2
\end{verbatim}

Both the early and late lints recorded the number of occurrences of each ABI for the rust functions, foreign functions, and static items declared in each crate. There were 4,155 crates that only appeared in results from the early lint. However, there were 3,437 crates that had one or more foreign ABIs that were \emph{only} detected in the early lint.

For qualitative analysis, we focus on the subset of improper type errors that
were explicitly hidden by developers that disabling the corresponding lint.

  \bibliography{book.bib,packages.bib}

\end{document}
